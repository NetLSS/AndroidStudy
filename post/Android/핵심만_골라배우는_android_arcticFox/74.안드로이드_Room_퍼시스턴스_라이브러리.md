# Android Room í¼ì‹œìŠ¤í„´ìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬

![Imgur](https://i.imgur.com/HODhpzK.jpg)

## ROOM ë°ì´í„°ë² ì´ìŠ¤ í¼ì‹œìŠ¤í„´ìŠ¤ì˜ í•µì‹¬ ìš”ì†Œ

### ë ˆí¬ì§€í† ë¦¬

- ë ˆí¬ì§€í† ë¦¬ ëª¨ë“ˆì€ ì•±ì—ì„œ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì§ì ‘ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ì½”ë“œë¥¼ í˜¸í•¨
- DBë‚˜ ì›¹ ì„œë¹„ìŠ¤ì™€ ê°™ì€ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë¥¼ UIì»¨íŠ¸ë¡¤ëŸ¬ ë° ë·°ëª¨ë¸ì—ì„œ ë¶„ë¦¬í•œë‹¤.

### Room ë°ì´í„°ë² ì´ìŠ¤

- SQLite ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µ.
- ë ˆí¬ì§€í† ë¦¬ê°€ DAO(Data Access Object)ë¥¼ ì‚¬ìš©í•˜ê²Œ í•´ì¤Œ.
- ì•±ì€ í•˜ë‚˜ì˜ Room ë°ì´í„°ë² ì´ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë§Œ ê°€ì§ˆ ìˆ˜ ìˆìŒ
- ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ìˆ˜ì˜ DB í…Œì´ë¸”ì„ ì‚¬ìš©ê°€ëŠ¥í•¨

### DAO

- SQLite ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ë¥¼ ì¶”ê°€, ì¡°íšŒ, ë³€ê²½, ì‚­ì œí•˜ê¸° ìœ„í•´ ë ˆí¬ì§€í† ë¦¬ê°€ í•„ìš”ë¡œ í•˜ëŠ” SQL ë¬¸ ì •ì˜
- í•´ë‹¹ SQL ë¬¸ì€ ë ˆí¬ì§€í† ë¦¬ì—ì„œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ì™€ ì—¬ê²°ë˜ì–´ ëŒ€ì‘í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê²Œëœë‹¤
  
### Entitiy

- ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•˜ëŠ” í´ë˜ìŠ¤
- í…Œì´ë¸” ëª…, ì—´ ì´ë¦„, ë°ì´í„° íƒ€ì…, ê¸°ë³¸í‚¤ ë“± ì •ì˜
- ê²Œí„°, ì„¸í„° í¬í•¨
- SQL ì¿¼ë¦¬ í•¨ìˆ˜ í˜¸ì¶œì˜ ì‘ë‹µìœ¼ë¡œ DAOì— ì˜í•´ì„œ ë ˆí¬ì§€í„°ë¦¬ë¡œ ë°˜í™˜ë˜ëŠ” ë°ì´í„°ëŠ” Entitiy í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ì˜ í˜•íƒœê°€ëœë‹¤.
- Insert í•  ë•Œë„ ë§ˆì°¬ê°€ì§€ë¡œ Entitiy ì¸ìŠ¤í„´ìŠ¤ì— ë°ì´í„°ë¥¼ ì±„ì›Œ DAOì— ìˆëŠ” insert ê¸°ëŠ¥ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.

### SQLite ë°ì´í„°ë² ì´ìŠ¤

- ë°ì´í„°ì˜ ì €ì¥ê³¼ ì œê³µì„ ë‹´ë‹¹
- ë ˆí¬ì§€í† ë¦¬ë¥¼ í¬í•¨í•œ ì•± ì½”ë“œë‹¨ì—ì„œëŠ” ì§ì ‘ SQLite DBë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì•¼ í•¨
- ëª¨ë“  ì‘ì—…ì€ Room ë°ì´í„°ë² ì´ìŠ¤, DAO, Entitiy ë¥¼ í†µí•´ í•´ì•¼í•¨

![Imgur](https://i.imgur.com/yoJvtDY.jpg)

1. ë ˆí¬ì§€í† ë¦¬ëŠ” Room DBì™€ ìƒí˜¸ì‘ìš©í•´ `ë°ì´í„°ë² ì´ìŠ¤ ì¸ìŠ¤í„´ìŠ¤`ë¥¼ ì–»ìŒ. í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ë¡œ `DAO ì¸ìŠ¤í„´ìŠ¤ì˜ ì°¸ì¡°`ë¥¼ ì–»ì„ ìˆ˜ ìˆìŒ
2. ë ˆí¬ì§€í† ë¦¬ëŠ” Entitiy ì¸ìŠ¤í„´ìŠ¤ ìƒì„±í›„ ë°ì´í„°ë¥¼ ì±„ì›Œì„œ ê²€ìƒ‰ì´ë‚˜ insert ì‹œ ì‚¬ìš©í•˜ê¸°ìœ„í•´ DAOì— ì „ë‹¬
3. ë ˆí¬ì§€í† ë¦¬ëŠ” DBì— ì¶”ê°€ë  Entitiyë¥¼ ì¸ìë¡œ ì „ë‹¬í•´ DAO í•¨ìˆ˜ë¥¼ í˜¸ì¶œ. or ê²€ìƒ‰ ì¿¼ë¦¬ì˜ ì‘ë‹µìœ¼ë¡œ Entitiy ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜
4. DAO ê°€ ë ˆí¬ì§€í† ë¦¬ì— ë°˜í™˜í•  ë°ì´í„°ë¥¼ ê°€ì§ˆ ë•Œ ì´ ë°ì´í„°ë¥¼ Entitiy ê°ì²´ì— ë„£ìŒ
5. DAO ëŠ” Room DBì™€ ìƒí˜¸ì‘ìš©í•˜ì—¬ DB ì‘ì—…ì„ ì‹œì‘ ë° ê²°ê³¼ë¥¼ ì²˜ë¦¬í•¨
6. Room ë°ì´í„°ë² ì´ìŠ¤ëŠ” SQLite ë°ì´í„°ë² ì´ìŠ¤ì™€ ìƒí˜¸ì‘ìš©í•˜ì—¬ ì¿¼ë¦¬ë¥¼ ìš”ì²­ ë° ê²°ê³¼ë¥¼ ë°›ê²Œë¨

### Entitiy ì½”ë“œ

- í…Œì´ë¸”ì€ ê°ê° í•˜ë‚˜ì˜ Entitiy í´ë˜ìŠ¤ì™€ ì—°ê´€ì§€ì–´ì§
- í…Œì´ë¸”ì˜ ìŠ¤í‚¤ë§ˆ ì •ì˜ ë° Room ì• ë…¸í…Œì´ì…˜ í¬í•¨

```kotlin
import androidx.room.ColumnInfo
import androidx.room.Entity // room ì‚¬ìš©
import androidx.room.PrimaryKey

// ë°ì´í„° í´ë˜ìŠ¤ë¡œ ì„ ì–¸
@Entity(tableName = "history_table") // room ì‚¬ìš©(roomì˜ ë°ì´í„° í´ë˜ìŠ¤) db í…Œì´ë¸”
data class History(
    @PrimaryKey val uid: Int?, // ìœ ë‹ˆí¬í•œ ì•„ì´ë”” (ê¸°ë³¸í‚¤ë¡œ ì‚¬ìš©ë˜ëŠ” ë“¯)
    @ColumnInfo(name = "expression") val expression: String?,
    @ColumnInfo(name = "result") val result: String?
)
```

```kotlin
@PrimaryKey(autoGenerate = true)
@NonNull
@Ignore
@Entity(ForeignKeys = @ForeignKey(entitiy = Customer.class, parentColumns = "id", childColumns = "purchaseId"))
```


### DAO ì½”ë“œ

- Data Access Object
- SQLite DBì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²• ì œê³µ
- ì½”í‹€ë¦° í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ë¡œ ì„ ì–¸

```kotlin
@Dao
interface CustomerDao {
    @Query("SELECT * FROM customers")
    fun getAllCustomers(): LiveData<List<Customer>> // LiveData ë¡œ ë°ì´í„° ë³€ê²½ì„ ê´€ì°° ê°€ëŠ¥

    @Query("SELECT * FROM customers WHERE name = :customerName")
    fun findCustomer(customerName: String): List<Customer> // :customerName ì—ì„œ ì‚¬ìš©

    @Insert
    fun addCustomer(customer: Customer)

    @Insert
    fun insertCustomers(vararg customers: Cutomer)

    @Query("DELETE FROM customers WHERE name = :name")
    fun deleteCustomer(name: String)

    @Delete
    fun deleteCustomers(vararg customers: Customer)

    @Update
    fun updateCustomers(vararg customers: Customer)

    @Delete
    fun deleteCustomers(vararg customers: Customer): Int // ì²˜ë¦¬ëœ í–‰ì˜ ê°œìˆ˜ ë°˜í™˜

}
```


### Room ë°ì´í„°ë² ì´ìŠ¤

```kotlin
import android.content.Context
import android.arch.persistence.room.Database
import android.arch.persistence.room.Room
import android.arch.persistence.room.RoomDatabase

@Database(entities = [(Cuetomer::class)]), version = 1) // ğŸ‘ˆ
abstract class CustomerRoomDatabase: RoomDatabase() {
    abstract fun customerDao(): CustomerDao

    companion object {
        private var INSTANCE: CustomerRoomDatabase? = null

        // internal ê°™ì€ ëª¨ë“ˆì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ì ‘ê·¼ ì œì–´ì
        internal fun getDatabase(context: Context): CustomerRoomDatabase? {
            if (INSTANCE == null) {
                synchronized(CustomerRoomDatabase::class.java) { // lock ì‹œì¼œ ë™ê¸°í™”
                    if (INSTANCE == null) {
                        INSTANCE = Room.databaseBuilder<CustomerRoomDatabase>(
                            context.applicationContext,
                            CustomerRoomDatabase::class.java,
                            "customer_database").build() // ğŸ‘ˆ
                        )
                    }
                }
            }
            return INSTANCE
        }
    }
}
```

### ë ˆí¬ì§€í† ë¦¬

- room ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì–»ê³ . DAOë¥¼ ì‚¬ìš©í•˜ì—¬ DAO í•¨ìˆ˜ í˜¸ì¶œí•´ì„œ DBë¥¼ ì‚¬ìš©.

```kotlin
class CustomerRepository(application: Application) {
    
    private var customerDao: CustomerDao?

    init {
        val db: CustomerRoomDatabase? = CustomerRoomDatabase.getDatabase(application)
        customerDao = db?.customerDao()
    }
    .
    .
}
```

```kotlin
val allCustomers: LiveData<list<Customer>>?
allCustomers = customerDao.getAllCustomers()
```

### in-memory ë°ì´í„°ë² ì´ìŠ¤

- Room ë°ì´í„°ë² ì´ìŠ¤ (SQLite)ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì˜êµ¬ì ìœ¼ë¡œ íŒŒì¼ë¡œ ì €ì¥ë˜ê¸° ë•Œë¬¸ì—. ì•± í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë˜ë„ ë°ì´í„°ëŠ” ê³„ì† ë³´ì¡´ëœë‹¤.
- Room ë°ì´í„°ë² ì´ìŠ¤ í¼ì‹œìŠ¤í„´ìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì¸ë©”ëª¨ë¦¬ ë°ì´í„°ë² ì´ìŠ¤ë„ ì§€ì›í•œë‹¤.
  - ë©”ëª¨ë¦¬ì—ë§Œ ì¡´ì¬. ì•±ì´ ì¢…ë£Œë˜ë©´ ì‚¬ë¼ì§
  - `Room.databaseBuilder()` ëŒ€ì‹ ì— `Room.inMemoryDatabaseBuilder()` í•¨ìˆ˜ í˜¸ì¶œ

```kotlin
// íŒŒì¼ ìŠ¤í† ë¦¬ì§€ ê¸°ë°˜ì˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.
INSTANCE = Room.databaseBuilder<CustomerRoomDatabase>(context.applicationContext, CustomerRoomDatabase::class.java, "customer_database")

// ì¸ë©”ëª¨ë¦¬ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤. (ë””ë¹„ëª…ì´ í•„ìš”ì—†ë‹¤.)
INSTANCE = Room.inMemoryDatabaseBuilder<CustomerRoomDatabse>(context.getApplicationContext(), CustomerRoomDatabase.class).build()
```

### ë°ì´í„°ë² ì´ìŠ¤ íƒìƒ‰ê¸°

- Database Inspector ë„êµ¬ ì°½
- ì‹¤í–‰ ì¤‘ì¸ ì•±ê³¼ ì—°ê´€ëœ Room ë°ì´í„° ë² ì´ìŠ¤ ë°ì´í„°ë¥¼ ì¡°íšŒ, ê²€ìƒ‰, ë³€ê²½, ì¶”ì¶œ ê°€ëŠ¥.