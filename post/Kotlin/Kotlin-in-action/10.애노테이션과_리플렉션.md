<!-- 
commit message
kotlin in action : Annotation

ìƒëµ ëœ ì±•í„°ëŠ” í–¥í›„ ì±„ì›Œì§ˆ ì˜ˆì •. ğŸ…
-->

# 10ì¥ ì—ë…¸í…Œì´ì…˜ê³¼ ë¦¬í”Œë ‰ì…˜

## 10.2.3 ì• ë…¸í…Œì´ì…˜ì„ í™œìš©í•œ ì§ë ¬í™” ì œì–´

ì œì´í‚¤ë“œì˜ ì§ë ¬í™” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì˜ˆë¡œ ë“ ë‹¤.

### @JsonExclude ë¡œ ì• ë…¸í…Œì´ì…˜ëœ í”„ë¡œí¼í‹°

```kotlin
val properties = kClass.memberProperties
    .filter { it.findAnnotation<JsonExclude>() == null}
```

JsonExlude ì• ë…¸í…Œì´ì…˜ ëœ í”„ë¡œí¼í‹°ë¥¼ í•„í„°ë§(ì œì™¸) í•œë‹¤. ğŸ‘

### @JsonName

```kotlin
annotation class JsonName(val name: String)

data class Person(
    @JsonName("alias") val firstName: String,
    val age: Int
)
```

@JsonName ì€ ìœ„ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆì—ˆë‹¤.

```kotlin
val jsonNameAnnotaion = prop.findAnnotation<JsonName>() // JsonName ì• ë…¸í…Œì´ì…˜ì„ ì–»ëŠ”ë‹¤ (ì—†ìœ¼ë©´ null)
val proName = jsonNameAnnotation?.name ?: prop.name // JsonName ì˜ name ì¸ìë¥¼ ì°¾ê³  ì—†ìœ¼ë©´ prop.name ì„ ì‚¬ìš© 
```

ìš°ë¦¬ì˜ ì»¤ìŠ¤í…€ ì§ë ¬í™” ë¡œì§ì— ìœ„ ì‚¬í•­ì„ ë°˜ì˜í•´ë³´ì

```kotlin
private fun StringBuilder.serializeObject(obj: Any) {
    obj.javaClass.kotlin.memberProperties
        .filter { it.findAnnotation<JsonExclude>() == null } // ì œì™¸ í”„ë¡œí¼í‹°ë¥¼ í•„í„°ë§ 
        .joinToStringBuilder(this, prefix = "{", postfix = "}") {
            serializeProperty(it, obj)
        }
}
```

â¬† @JsonExclude ì• ë…¸í…Œì´ì…˜ì„ ì²˜ë¦¬í•œë‹¤.

```kotlin
private fun StringBuilder.serializeProperty(
    prop: KProperty1<Any, *>, obj: Any
) {
    val jsonNameAnn = prop.findAnnotation<JsonName>()
    val propName = jsonNameAnn?.name ?: prop.name // @JsonName ì— ë”°ë¼ ì´ë¦„ ì²˜ë¦¬
    serializeString(propName)
    append(": ")
    serializePropertyValue(prop.get(obj))
}
```

â¬† @JsonName ì„ ì²˜ë¦¬í•œë‹¤.  

### `@CustomSerializer`

`@CustomSerializer` ëŠ” `getSerializer` ë¼ëŠ” í•¨ìˆ˜ì— ê¸°ì´ˆí•œë‹¤.

`getSerializer` ëŠ” `@CustomSerializer` ë¥¼ í†µí•´ ë“±ë¡í•œ `ValueSerializer` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.

```kotlin
data class Person(
    val name: String,
    @CustomSerializer(DateSerializer::class) val birthDate: Date
)
```

```kotlin
annotation class CustomSerializer(
    val serializerClass: KClass<out ValueSerializer<*>>
)
```

í”„ë¡œí¼í‹°ì˜ ê°’ì„ ì§ë ¬í™”í•˜ëŠ” ì§ë ¬í™”ê¸° ê°€ì ¸ì˜¤ê¸°

```kotlin
fun KProperty<*>.getSerializer(): ValueSerializer<Any?>? {
    val customSerializerAnn = findAnnotation<CustomSerializer>() ?: return null
    val serializerClass = customSerializerAnn.serializerClass
    val valueSerializer = serializerClass.objectInstance ?: serializerClass.createInstance()
    @Suppress("UNCHECKED_CAST")
    return valueSerializer as ValueSerializer<Any?>
}
```

`getSerializer()` ê°€ ì£¼ë¡œ ë‹¤ë£¨ëŠ” ê°ì²´ê°€ `KProperty` ì˜ ì¸ìŠ¤í„´ìŠ¤ ì´ê¸° ë•Œë¬¸ì— `KProperty` ì˜ í™•ì¥ í•¨ìˆ˜ë¡œ ì •ì˜


    